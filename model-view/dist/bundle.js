!function(){"use strict";function e(e){this._ctx=e||this,this._cbs=this._cbs||{}}var t=e.prototype;t.on=function(e,t){return this._cbs[e]=this._cbs[e]||[],this._cbs[e].push(t),this},t.off=function(e,t){if(!arguments.length)return this._cbs={},this;if(1===arguments.length)return delete this._cbs[e],this;var i=this._cbs[e];if(!i)return this;for(var n=0;n<i.length;n++)if(i[n]===t){i.splice(n,1);break}return this},t.emit=function(e,t,i,n){var r=this._cbs[e];if(r)for(var o=0,s=r.length;o<s;o++)r[o].call(this._ctx,t,i,n);return this};var i=1;function n(e,t){this.id=i++,this.value=void 0,this.compiler=e,this.key=t,this.dirs=[]}n.prototype.update=function(e){if(this.value=e,this.dirs.length>0)for(var t=0;t<this.dirs.length;t++)this.dirs[t].$update(e)};var r=Object.defineProperty;function o(e,t){var i=e.__emitter__,n=i.values;function o(e){n[t]=e,i.emit("set",t,e)}o(e[t]),r(e,t,{enumerable:!0,configurable:!0,get:function(){return n[t]},set:function(e){o(e)}})}var s,c,a=function(t,i){!function(t){var i=new e;r(t,"__emitter__",{value:i,configurable:!0,enumerable:!1}),i.values=Object.create(null)}(t);var n=t.__emitter__;i.proxies={};var s=i.proxies={set:function(e,t){e&&i.emit("set",e,t)}};n.on("set",s.set),function(e){for(var t in e)o(e,t)}(t)},u=/[-.*+?^${}()|[\]\/\\]/g,h=(s=l("{"),c=l("}"),new RegExp(s+s+s+"?(.+?)"+c+"?"+c+c));function l(e){return e.replace(u,"\\$&")}var f=function(e){if(!h.test(e))return null;for(var t,i,n,r,o=[];t=e.match(h);)(i=t.index)>0&&o.push(e.slice(0,i)),n={key:t[1].trim()},r=t[0],n.html="{"===r.charAt(2)&&"}"===r.charAt(r.length-3),o.push(n),e=e.slice(i+t[0].length);return e.length&&o.push(e),o},d=1;function v(e,t){this.id=d++,this.name=e,this.el=t}var p=v.prototype;p.$update=function(e){this.el.textContent=e},p.getKey=function(){return this.name};var m={}.hasOwnProperty,b=Object.defineProperty,g=[].slice;function _(e,t){var i=this,n=i.el=i.setupElement(t);i.vm=n.vue_vm=e,i.bindings=Object.create(null),i.options=t||{},e.$el=n,e.$options=t,e.$compiler=i,i.setupObserver();var r=i.data=t.data||{};e.$data=r,i.observeData(r),i.compile(n,!0)}var y=_.prototype;y.setupElement=function(e){return document.querySelector(e.el)},y.setupObserver=function(){var t=this,i=t.bindings;(t.observer=new e(t.vm)).on("set",(function(e,n){(function(e){i[e]||t.createBinding(e)})(e),i[e].update(n)}))},y.createBinding=function(e){var t=this,i=t.bindings,r=new n(t,e);return i[e]=r,t.defineDataProp(e,r),r},y.defineDataProp=function(e,t){var i=this,n=i.data;m.call(n,e)||(n[e]=void 0),t.value=n[e],b(i.vm,e,{get:function(){return i.data[e]},set:function(t){i.data[e]=t}})},y.observeData=function(e){var t=this.observer;a(e,t)},y.compile=function(e){var t=e.nodeType;1===t?this.compileElement(e):3===t&&this.compileTextNode(e)},y.compileElement=function(e){e.hasChildNodes()&&g.call(e.childNodes).forEach(this.compile,this)},y.compileTextNode=function(e){var t=f(e.nodeValue);if(t){for(var i,n,r,o=0,s=t.length;o<s;o++)(n=t[o]).key?(i=document.createTextNode(""),r=new v(n.key,i)):i=document.createTextNode(n),e.parentNode.insertBefore(i,e),this.bindDirective(r);e.parentNode.removeChild(e)}},y.bindDirective=function(e){var t=this.bindings[e.getKey()];t.dirs.push(e),e.$update(t.value)},window.ViewModel=function(e){console.log("create new VM, options: "+JSON.stringify(e)),new _(this,e)}}();